# 蘑菇牌RPG 说明书

<br>

## 目录
- [主界面](#主界面)
- [故事板](#故事板)
- [剧目](#剧目)
- [剧情元素](#剧情元素)
- [条件域](#条件域)
- [宏](#宏)
- [人物](#人物)
- [物品](#物品)
- [地图](#地图)
- [技能](#技能)
- [被动](#被动)
- [技能元素](#技能元素)
- [战斗系统](#战斗系统)
- [战斗AI](#战斗AI)
- [客制化与发布](#客制化与发布)
- [官方模板剧本](#官方模板剧本)

<br>
<br>
<br>
<br>

## 主界面
- `剧本编辑`： 进入故事板编辑剧本
- `开始游戏`： 游玩编辑好的剧本

<br>
<br>
<br>
<br>

## 故事板

### 按键操作
- `ctrl + 滚轮`： 缩放
- `鼠标中键拖动`： 拖动故事板
- `鼠标右键`： 呼出菜单
- `鼠标左键`： 选中
- `鼠标左键拖动`： 框选
- `Ctrl + Z`：撤销
- `Ctrl + Shift + Z` 或 `Ctrl + Y`：取消撤销

### 素材路径
游戏图片/音频素材请放入这个文件夹或它的子文件夹内。

### 主角名字
输入游戏主角名字（需有对应的[人物](#人物)在故事板中）

### 故事板分页

- 用于细分大的剧本，作用类似Excel中的sheet。
- 点击"+"按钮新建分页
- 拖动排序，分页位置越高其中[剧目](#剧目)的[触发优先级](#剧目优先级)越高
- 分页只是视觉效果，各分页的元素都是互通的

### 搜索
- 搜索将显示故事板中某个文案的所有出现位置
- 点击搜索图标开始搜索，或选中文本后按`ctrl+f`搜索选中的文本

<br>
<br>
<br>
<br>

## 剧目

### 触发方式
触发方式游戏中是触发剧目所需的方式，包括对话人物，进入地区等

>剧目触发过一次后不会再次触发（[环形流程](#环形流程)除外）

>人物血量≤和战斗进行到N回合往往需要搭配[条件](#条件)使用，见[战斗中剧情](#战斗中剧情)

### 条件
- 剧目触发需满足的条件，包括自定义，概率，计数器≥，人物拥有物品，人物拥有随从
- 自定义条件可被[剧情元素](#剧情元素)：[激活条件](#激活条件)激活
- 已激活的自定义条件可被[剧情元素](#剧情元素)：[移除条件](#移除条件)移除
- 在条件前勾选NOT，表示否定，只有在该条件不成立时才能触发该剧目

### 剧目可激发态
- 游戏开始时所有没有前置[剧情连线](#剧目连线)的剧目均处于可激发态
- 剧目在执行后会进入不可激发态，处于不可激发态的剧目无法被触发

### 剧情
- 此剧目触发后播放的剧情
- 由剧情元素队列组成，剧情元素包括人物对话，展示图片，战斗等。详见[剧情元素](#剧情元素)
- 剧情元素由上往下依次播放，拖动可排序

### 剧目优先级
当两个不同剧目的触发方式和条件同时被满足时，会触发优先级更高的剧目。
- 在单个[故事板分页](#故事板分页)中，位置越高的剧目触发优先级越高。
- 如有多个[故事板分页](#故事板分页)，分页位置越高，其中剧目的触发优先级越高。

### 剧目连线
- `在一个剧目A中添加剧情元素`[激活剧目](#激活剧目)（或[选项](#选项)等其他有激活剧目箭头的剧情元素）
- `拖动箭头">"，连接到另一个剧目B左边的接收槽">"`
- 游戏开始时剧目B将处于[不可激发态](#剧目可激发态)。只有当剧目A的[激活剧目](#激活剧目)执行后剧目B才会进入[可激发态](#剧目可激发态)。

### &&开关
- `在一个剧目A中添加剧情元素`[激活剧目](#激活剧目)（或[选项](#选项)等其他有激活剧目箭头的剧情元素）
- `拖动箭头">"，连接到另一个剧目C左边的接收槽">"`
- `在一个剧目B中添加剧情元素`[激活剧目](#激活剧目)（或[选项](#选项)等其他有激活剧目箭头的剧情元素）
- `拖动箭头">"，连接到另一个剧目C左边的接收槽">"`
- `点击剧目C左边的接收槽">"， 打开&&开关`
- 游戏开始时剧目C将处于[不可激发态](#剧目可激发态)。只有当剧目A和剧目B的[激活剧目](#激活剧目)都执行后剧目C才会进入[可激发态](#剧目可激发态)。
- `再次点击剧目C左边的接收槽">"， 关闭&&开关`
- 只要剧目A和剧目B的[激活剧目](#激活剧目)中的任意一个执行，剧目C就会进入[可激发态](#剧目可激发态)。

### 环形流程
- 单剧目环：
  - 剧目内部的剧目连线连接剧目自身的接收槽，该剧目可以反复触发。
- 多剧目环：
  - 使用剧目连线将多个剧目连成一个环。
  - 新建一个入口剧目a并添加剧情元素`[激活剧目](#激活剧目)，将激活剧目的箭头连接到剧目环的起始剧目。

### 底层机制
- 玩家在游戏中产生可能会触发剧情的交互（比如进入地区，对话）
- 程序对剧本中所有剧目按[剧目优先级](#剧目优先级)依次检测
- 如果该剧目 
  1. 触发方式与玩家此次的交互一致
  2. 是可激发态（见[剧目可激发态](#剧目可激发态)）
  3. 剧目条件均已满足
- 执行该剧目
- 移除该剧目激活的激活状态
- 停止向下检测

<br>
<br>
<br>
<br>

## 剧情元素

### 激活条件
激活一个[自定义条件](#条件)

### 移除条件
移除一个[条件](#条件)

### 激活剧目
激活一个[剧目](#剧目)，使其进入可激发态

### 增加计数
增加一个计数器的值，用于[条件](#条件)判断

### 选项
给玩家选择的选项
- `点击编辑`
- `点击“+”按钮添加选项`
- `输入选项内容`
- `使用箭头连接该选项激活的剧目`

### 传送人物
瞬间传送某个[人物](#人物)到某个[地点](#地点)
>可通过传送主角实现地图间的切换

### 移动人物
移动某个[人物](#人物)到某个[地点](#地点)，人物和地点需在同一张地图上。
>人物会随机移动到目的地地点范围内的某个点上，因此可以用目的地地点范围的大小来调节移动路径的随机性

### 人物跟随人物
某个[人物](#人物)成为某个人物的[随从](#随从)

### 人物停止跟随人物
某个[人物](#人物)停止成为某个人物的[随从](#随从)

### 改变人物立绘

### 对话
- `点击编辑`
- `点击“+”按钮添加对话`
- `输入说话人物名字`
- `输入说话内容`
- `输入配音音频文件名（可选）`
- `输入自动跳过时间（不填则为鼠标点击/空格跳过）`
- `输入特殊立绘图片名（可选）`
- `拖动人物头像可排序`
- `按“tab”键快速切换输入框`

### 展示图片
展示图片，可选点击跳过，定时跳过，或使用[移除背景](#移除背景)手动移除

### 移除背景
移除展示的图片。

### 音效
如果音效为bgm，请勾选bgm选项确保它的音量可被游戏中bgm音量滑块调节。

### 停止音效

### 交易
>交易中购买物品需支付等于物品价值的金钱，出售则获得物品价值80%的金钱。

### 获得金钱
某个[人物](#人物)获得金钱
### 获得物品
某个[人物](#人物)获得[物品](#物品)
### 失去物品
某个[人物](#人物)失去[物品](#物品)
### 获得并装备物品
某个[人物](#人物)获得并装备[物品](#物品)，如果装备槽位已有装备，则旧装备放回背包中
### 停止装备物品
某个[人物](#人物)停止装备[物品](#物品)，并放回背包中
### 交付金钱物品
请求主角交付金钱或物品， 成功或失败都可激活剧目
### 战斗
展开[战斗](#战斗系统)，胜利或失败都可激活剧目
### 脱离当前战斗
### 获得技能
### 失去技能
### 援兵
给当前进行中的战斗添加援兵

### 切换主角
将某个[人物](#人物)切换为主角
>切换主角后注意保证主角相关剧目的正常触发，见[主角代号](#人物#主角代号) 

### 杀死人物
### 复活人物
### 更换地图图片
### 修改景物图片
不填为移除景物当前的图片
### 激活障碍
### 禁用障碍
### 移动相机到地点
### 复位相机
### 震动相机
### 轨迹特效
### 特效
### 地图上展示图片
### 抵近目标

<br>
<br>
<br>
<br>

## 条件域
所有在条件域内的剧目需要满足条件域的条件才能触发. 通常会用在只在某个任务中触发的剧情。
### 创建
- `右键菜单` -> `+条件域`
- 拖动四角来调整大小.

<br>
<br>
<br>
<br>

## 宏
宏是一组可以复用的剧情元素，并且可以传入参数。

### 创建
- `右键菜单` -> `+宏`

<br>
<br>
<br>
<br>

## 人物

### 创建
- `右键菜单` -> `+人物`

### 参数
| 参数 | 描述 |
| --- | ----------- |
| 头衔 | 人物头衔 |
| 名字 | 人物名字，如名字包含\*号，\*号之后的文本在游戏中不显示（见[龙套人物](#龙套人物)） |
| 图片文件名 | 输入人物图片文件名含后缀 |
| 帽子 | 人物所装备的帽子，输入种类为帽子的[物品](#物品)名字 |
| 衣服 | 人物所装备的衣服，输入种类为衣服的[物品](#物品)名字 |
| 武器一 | 人物所装备的武器，输入种类为武器的[物品]，某些种类的[技能](#技能)需要装备对应种类的武器才能发动 |
| 武器二 | 同上 |
| 物品 | 人物背包中的[物品](#物品)名字），使用`物品名*4`的格式来表示复数 |
| 技能/被动 | 人物拥有的[技能](#技能)/[被动](#被动)名|
| 随从 | 随从人物名字。见[随从人物](#随从人物) |

### 随从人物
- [战斗](#战斗)中随从会跟随主人加入战斗。
- 为防止循环套娃，随从的随从不会加入战斗。

### 龙套人物
有时游戏需要龙套型的人物，比如四个卫兵。他们不需要具体姓名。将四个卫兵的名字设为

卫兵\*1, 卫兵\*2, 卫兵\*3, 卫兵\*4

在游戏中，他们的显示名字会省略\*号和\*号后面的内容, 均为卫兵

### 主角代号
为保证在[切换主角](#切换主角)后主角相关剧目的正常触发，可以使用主角代号 `--hero--` 来指代当前主角名字

<br>
<br>
<br>
<br>

## 物品

### 创建
- `右键菜单` -> `+物品`

### 参数
| 参数 | 描述 |
| --- | ----------- |
| 名字 | 物品名字 |
| 图片文件 | 图片文件 |
| 物品描述 | 游戏中显示的物品描述，如有书信类的物品可直接把内容写在描述中便于玩家阅读 |
| 种类 | 物品的种类，包括衣，帽，武器，其他。作用见[人物](#人物) |
| 武器种类 | 当物品为武器时，可自定义武器的种类（刀剑，暗器等）。[技能](#技能)可以设置需要装备某种种类的武器才可发动。 |
| 价值 | 在[交易](#交易)中购买此物品所需的金钱 |
| 重量 | 在背包中的重量 |
| 不可交易或丢弃 | 防止玩家丢失重要的任务道具 |
| 技能/被动 | 此物品提供的[技能](#技能)/[被动](#被动)名字，如果物品为装备，只有在装备它时才能获得它提供的技能/被动|

<br>
<br>
<br>
<br>

## 地图

### 创建
- `右键菜单` -> `+地图`
- `输入地图名字`
- `点击编辑`： 进入地图编辑器
- `输入地图图片文件名`： 加载地图图片
- `输入缩放比例`： 调整地图图片大小
- 放置地点，景物，人物，物品
- 勾选层来选择性显示地点，景物，人物，物品

### 地点

### 景物
地图上的图片，可以在游戏过程中使用剧情元素：[修改景物图片](#修改景物图片)动态修改

### 人物
地图人物，放置后输入在故事板中定义的人物名。

### 物品
物品，分可拾取和不可拾取。

### 障碍物

- 障碍是阻止玩家移动和交互（对话，捡东西）的墙壁，“障碍矮”仅阻止移动不阻止交互。
- `点击放置好的障碍`：命名障碍，便于[剧情元素](#剧情元素)：[激活障碍](#激活障碍)和[禁用障碍](#禁用障碍)禁用或激活。

<br>
<br>
<br>
<br>

## 技能

### 创建
- `右键菜单` -> `+技能`

### 参数
| 参数 | 描述 |
| --- | ----------- |
| 名字 | 输入技能名字 |
| 技能描述 | 游戏中显示的技能描述 |
|远程| 是否为远程技能，发动远程技能时不会成为[前排](#前排) |
| 武器种类 | 技能所需的武器种类，用户自定义。如不为空则该技能需装备对应种类的[物品](#物品)才可发动。|
|循环次数|技能重复发动的次数|
| 技能元素队列 | `点击+按钮添加技能元素`，技能效果由多个技能元素组成，拖动可排序。见[技能元素](#技能元素) |

<br>
<br>
<br>
<br>

## 被动

### 创建
- `右键菜单` -> `+被动`

### 参数
| 参数 | 描述 |
| --- | ----------- |
| 名字 | 输入被动名字 |
| 被动描述 | 游戏中显示的被动描述 |
| 种类 | 被动的触发种类 |
| 控制 | 拥有带控制被动的人物的行动将被跳过 |
| 暴击 | 被动所提供的额外暴击率 |
| 伤害补正 | 输入小数，正数为增加，负数为减小 |
|循环次数|技能重复发动的次数|
| 技能元素队列 | `点击+按钮添加技能元素`，技能效果由多个技能元素组成，发动时由上往下依次发动，拖动可排序。见[技能元素](#技能元素) |

<br>
<br>
<br>
<br>

## 技能元素
技能元素由作用对象，条件，效果组成，由上往下依次发动，拖动可排序。

### 对象
- 自身
- 单体
- 己方群体
- 己方群体（除自身）
- 敌方群体
- 全体
- 全体（除自身）
- 伤害来源（仅存在于受攻击时触发的被动）
- 伤害目标（仅存在于攻击时触发的被动）

>群体类目标可设置最大目标数，如最大目标数<目标群体人数则随机从目标群体中抽取=最大目标数的单位作为目标

### 条件
条件决定了效果是否触发，如不满足则跳过此效果

|类型|参数|
| --- | ----------- |
|概率（独立）|触发的概率（小数），不填为0|
|概率（互斥）|触发的概率（小数），在此技能元素内，会于其他概率（互斥）条件互斥，例如：有50%互斥概率造成1伤害，50%互斥概率造成2伤害，则只会有两种结果，造成1伤害和造成2伤害|
|拥有被动|拥有的被动名字|
|招架≥|招架量|
|内力≥|内力量|
|被控(拥有带控制的被动)||
|位于前排||

##### 条件对象
判定条件的对象，包括施法者，目标

##### NOT选项
选择之后条件判断会反着来，比如拥有被动a将变为不拥有被动a

### 效果
对目标造成的技能效果

>#### 伤害类的技能效果可选择伤害类型
>- 物理伤害
>- 内力伤害
>- 真实伤害：没有随机波动，不减少目标的招架，也不会触发造成/受到伤害时触发的被动
>##### 无来源
>- 勾选后伤害没有来源，因此不会触发对伤害来源造成的效果
>#### 轨迹特效，打击特效
>粒子特效，其中轨迹特效可以添加抛射物的图片（可以自己制作飞刀之类的图片加上去，图片上方为抛射方向）

<br>
<br>
<br>
<br>

## 战斗系统

### 流程
1. 主角和主角的[随从](./character#随从)，友方和友方的[随从](./character#随从)进入战斗，敌人和敌人的[随从](./character#随从)进入战斗
2. 敌方行动
3. 友方行动
4. 己方（玩家）行动

### 友方
如果设置了友方人物，友方人物和他的随从会加入玩家一边但不受玩家操控

### 前排
- 前排为战斗中双方位置在前的单位。
- 当一个战斗单位发动非远程的[技能](#技能)时，会成为前排。
- 在敌方场上存在前排单位时，单体[技能](#技能)的目标只能是对方的前排。

### 架势
单位HP受到伤害时架势会受到等量伤害，单位架势为0时撤退到后排并无法行动1回合（无法行动回合数可在剧本中设置）

<br>
<br>
<br>
<br>

## 战斗AI
战斗AI由多个行为单元组成，行动时由上往下依次检测，一旦条件符合就触发该行为定义的技能并停止向下检测，拖动可排序。

### 创建
- `右键菜单` -> `+战斗AI`

<br>
<br>
<br>
<br>

## 客制化与发布
更换游戏皮肤，屏蔽编辑器和剧本选择来客制化您的游戏便于发布

### 游戏UI皮肤
- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/gameSkin`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 替换文件夹内的图片来更换皮肤(图片名字不变，后缀是jpg或png都可以)
- 重新启动游戏

>为确保不变形，皮肤图宽高比需和原图一致

#### UI对照表
| 图片文件名 | 描述 | 宽高比 |
| --------- | ---- | ----- |
| button | 通用按钮 | 4 : 1 |
| card | 物品卡/选项卡面板 | 2.5 : 3.5 |
| clothe | 衣服装备槽 | 2.5 : 3.5 |
| cover | 封面图/载入图 | 16 : 9 |
| dead | 死亡标记 | 1 : 2 |
| dialog | 对话框 | 2160 : 240 |
| hat | 帽子装备槽 | 2.5 : 3.5 |
| label | 长标签 | 8 : 1 |
| mp | 法力图标 | 1 : 1 |
| panel | 通用面板 | 16 : 9 |
| passive | 被动技能按钮 | 4 : 1 |
| sack | 物品图标 | 1 : 1 |
| spell | 技能图标 | 1 : 1 |
| talk | 对话图标 | 1 : 1 |
| weapon | 武器装备槽 | 2.5 : 3.5 |

#### 游戏文字颜色
- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 使用文本编辑器打开`config.json`
- 修改 "gameTextColor": [ R, G, B, A ]
    - R为红色，允许值[0, 1]
    - G为绿色，允许值[0, 1]
    - B为蓝色，允许值[0, 1]
    - A为透明度，允许值[0, 1]，0为全透明，1为不透明
    - 例："gameTextColor": [ 1, 0, 0, 0.5 ] 为半透明红色
- 重新启动游戏

#### 像素风
如果游戏图片素材为低像素风格，请开启point filter防止图片模糊
- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 使用文本编辑器打开`config.json`
- 将 "pointFilter": false 改为 "pointFilter": true
- 重新启动游戏

### 编辑器UI皮肤
- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/editorSkin`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 替换文件夹内的图片来更换皮肤(图片名字不变，后缀是jpg或png都可以)
- 重新启动游戏

>可以删除editorSkin下的所有UI图片，程序会使用一套默认的深色风格UI

#### UI对照表
| 图片文件名 | 描述 | 尺寸/宽高比 |
| --------- | ---- | ----- |
| background | 背景 | 1 : 1 |
| button | 通用按钮 | 64px * 64px |
| cross | 叉 | 1 : 1 |
| panel | 面板 | 256px * 256px |

>通用按钮和面板这两个UI因为使用了border，为确保不变形，**像素高度和宽度**需和原图一致

>背景为重复平铺图片，尺寸越大重复密度越小

#### 剧本编辑器文字颜色
- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 使用文本编辑器打开`config.json`
- 修改 "editorTextColor": [ R, G, B, A ]
    - R为红色，允许值[0, 1]
    - G为绿色，允许值[0, 1]
    - B为蓝色，允许值[0, 1]
    - A为透明度，允许值[0, 1]，0为全透明，1为不透明
    - 例："editorTextColor": [ 1, 0, 0, 0.5 ] 为半透明红色
- 重新启动游戏

### 屏蔽编辑器
- 进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/`文件夹
- 使用文本编辑器打开`config.json`
- 将`disableEditor`值改为1
- 重新启动游戏

### 屏蔽剧本选择
如果游戏只有一个剧本，可以屏蔽剧本选择让玩家直接进入存档选择
- 把多余的剧本删掉只留下一个需要的剧本
- 进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/config/`文件夹
- 使用文本编辑器打开`config.json`
- 将`disableScriptPicking`值改为1
- 重新启动游戏

### 版权
蘑菇牌RPG只是制作工具，不占有使用其制作的游戏的版权

<br>
<br>
<br>
<br>

## 官方模板剧本
官方提供的剧本案例，可以学习参考

- 进入进入程序文件夹内`MushRoomCardRPG_Data/streamingAssets/template/`文件夹。（程序文件夹路径可在[素材路径](./storyboard.html#素材路径)中查看）
- 将其中的剧本复制到`MushRoomCardRPG_Data/streamingAssets/myStories/`
